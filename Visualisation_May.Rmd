---
title: "Visualisation"
authors: Cosmia, Nina and Viviane
output: html_document
date: '2023-04-24'
---
Load all necessary packages
```{r echo = FALSE, message = FALSE}
library(tidyverse)
library(ggplot2)
library(dplyr)
```


Read in the data 
```{r echo = FALSE, message = FALSE}
data <- read.csv("satisfaction_2015.csv", header = TRUE)
summary(data)
```

DATA WRANGLING I
```{r echo = FALSE, message = FALSE}
data_clean <- data %>%  
  select(-c (id,Customer.Type,satisfaction_v2,Departure.Delay.in.Minutes,Arrival.Delay.in.Minutes))  
  
#Class as factor + levels 
data_clean$Class <- factor(data_clean$Class)

class_levels <- levels(data_clean$Class)

data_clean <- data_clean %>%
  mutate_at(vars(Seat.comfort, Online.boarding, On.board.service, Baggage.handling, Checkin.service, Inflight.service, Inflight.wifi.service, Departure.Arrival.time.convenient, Ease.of.Online.booking, Gate.location, Food.and.drink, Inflight.entertainment, Leg.room.service, Cleanliness), as.numeric)

data_clean <- as_tibble(data_clean)
```

NA's ANALYSIS
```{r echo = FALSE}
#Percentage of NA's for each column 
data_clean[data_clean == 0] <- NA

na_percentages <- colMeans(is.na(data_clean)) * 100


##  Print the results
cat("Percentage of missing values for each column:\n")
cat(sprintf("%s: %.2f%%\n", names(na_percentages), na_percentages))

#mean NA
mean(na_percentages)

```

NA: Remove 

```{r echo = FALSE, message = FALSE}
data_clean <- data_clean %>% 
  filter(!is.na(Seat.comfort)) %>% 
  filter(!is.na(Online.boarding))  %>% 
  filter(!is.na(On.board.service)) %>% 
  filter(!is.na(Baggage.handling))  %>% 
  filter(!is.na(Checkin.service)) %>% 
  filter(!is.na(Inflight.service))  %>% 
  filter(!is.na(Inflight.wifi.service)) %>% 
  filter(!is.na(Departure.Arrival.time.convenient))  %>% 
  filter(!is.na(Ease.of.Online.booking))  %>% 
  filter(!is.na(Gate.location)) %>% 
  filter(!is.na(Food.and.drink))  %>% 
  filter(!is.na(Inflight.entertainment)) %>% 
  filter(!is.na(Cleanliness))  %>% 
  filter(!is.na(Leg.room.service)) 
```

DATA INSPECTION 
Personal vs. work travelers
```{r echo = FALSE, message = FALSE}
#Mean business travelers in business class
meanBBC <- data_clean %>%
  filter(Type.of.Travel == 'Business travel' & Class == "Business" & Class != 'Eco Plus' ) %>%
  select(Seat.comfort, Online.boarding, On.board.service, Baggage.handling, Checkin.service, Inflight.service, Inflight.wifi.service, Departure.Arrival.time.convenient, Ease.of.Online.booking, Gate.location, Food.and.drink, Inflight.entertainment, Leg.room.service, Cleanliness) %>%
  unlist() %>%
  mean()

#Mean business travelers in economy class
meanBEC <- data_clean %>%
  filter(Type.of.Travel == 'Business travel' & Class == "Eco" & Class != 'Eco Plus' ) %>%
  select(Seat.comfort, Online.boarding, On.board.service, Baggage.handling, Checkin.service, Inflight.service, Inflight.wifi.service, Departure.Arrival.time.convenient, Ease.of.Online.booking, Gate.location, Food.and.drink, Inflight.entertainment, Leg.room.service, Cleanliness) %>%
  unlist() %>%
  mean()

#Mean personal travelers in business class
meanPBC <- data_clean %>%
  filter(Type.of.Travel == 'Personal Travel' & Class == "Business" & Class != 'Eco Plus' ) %>%
  select(Seat.comfort, Online.boarding, On.board.service, Baggage.handling, Checkin.service, Inflight.service, Inflight.wifi.service, Departure.Arrival.time.convenient, Ease.of.Online.booking, Gate.location, Food.and.drink, Inflight.entertainment, Leg.room.service, Cleanliness) %>%
  unlist() %>%
  mean()

#Mean personal travelers in economy class
meanPEC <- data_clean %>%
  filter(Type.of.Travel == 'Personal Travel' & Class == "Eco" & Class != 'Eco Plus' ) %>%
  select(Seat.comfort, Online.boarding, On.board.service, Baggage.handling, Checkin.service, Inflight.service, Inflight.wifi.service, Departure.Arrival.time.convenient, Ease.of.Online.booking, Gate.location, Food.and.drink, Inflight.entertainment, Leg.room.service, Cleanliness) %>%
  unlist() %>%
  mean()


```

VISUALISATION Business vs. Personal travel 
```{r echo = FALSE}
means_df <- data.frame(Type.of.Travel = c("Business Travel", "Business Travel", "Personal Travel", "Personal Travel"),
                        Class = c("Business", "Eco", "Business", "Eco"),
                        Mean = c(meanBBC, meanBEC, meanPBC, meanPEC))

ggplot(means_df, aes(x = Type.of.Travel, y = Mean, fill = Class)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Type of Travel", y = "Satisfaction Level") +
  ggtitle("Mean Satisfaction Level by Type of Travel and Class") +
  scale_fill_manual(values = c("Business" = "blue", "Eco" = "red")) +
  ylim(0, 5)
```



DATA WRANGLING II 
Select only passengers that travel for business reasons. 
```{r echo = FALSE, message = FALSE}
data_clean <- data_clean %>%  
  filter(Type.of.Travel == 'Business travel' & Class != 'Eco Plus')

```


CALCULATIONS
Compute proportions and delta's

```{r echo = FALSE, message = FALSE }
data_prop<- data_clean %>% 
  mutate(proportion_SeatComfort_business = sum(Seat.comfort > 3 & Class == "Business") / sum(Class == "Business"),
         proportion_SeatComfort_economy = sum(Seat.comfort > 3 & Class == "Eco") / sum(Class == "Eco"),
         proportion_OnlineBoarding_business = sum(Online.boarding > 3 & Class == "Business") / sum(Class == "Business"),
         proportion_OnlineBoarding_economy = sum(Online.boarding > 3 & Class == "Eco") / sum(Class == "Eco"),
         proportion_OnboardingService_business = sum(On.board.service > 3 & Class == "Business") / sum(Class == "Business"),
         proportion_OnboardingService_economy = sum(On.board.service> 3 & Class == "Eco") / sum(Class == "Eco"),
         proportion_BaggageHandling_business = sum(Baggage.handling > 3 & Class == "Business") / sum(Class == "Business"),
         proportion_BaggageHandling_economy = sum(Baggage.handling > 3 & Class == "Eco") / sum(Class == "Eco"),
         proportion_CheckIn_business = sum(Checkin.service > 3 & Class == "Business") / sum(Class == "Business"),
         proportion_CheckIn_economy = sum(Checkin.service > 3 & Class == "Eco") / sum(Class == "Eco"),
         proportion_InflightService_business = sum(Inflight.service > 3 & Class == "Business") / sum(Class == "Business"),
         proportion_InflightService_economy = sum(Inflight.service > 3 & Class == "Eco") / sum(Class == "Eco"),
         proportion_Wifi_business = sum(Inflight.wifi.service > 3 & Class == "Business") / sum(Class == "Business"),
         proportion_Wifi_economy = sum(Inflight.wifi.service > 3 & Class == "Eco") / sum(Class == "Eco"),
         proportion_TimeConvenience_business = sum(Departure.Arrival.time.convenient > 3 & Class == "Business") / sum(Class == "Business"),
         proportion_TimeConvenience_economy = sum(Departure.Arrival.time.convenient > 3 & Class == "Eco") / sum(Class == "Eco"),
        proportion_OnlineBooking_business = sum(Ease.of.Online.booking > 3 & Class == "Business") / sum(Class == "Business"),
         proportion_OnlineBooking_economy = sum(Ease.of.Online.booking > 3 & Class == "Eco") / sum(Class == "Eco"),
         proportion_GateLocation_business = sum(Gate.location > 3 & Class == "Business") / sum(Class == "Business"),
         proportion_GateLocation_economy = sum(Gate.location > 3 & Class == "Eco") / sum(Class == "Eco"),
         proportion_FoodDrink_business = sum(Food.and.drink> 3 & Class == "Business") / sum(Class == "Business"),
         proportion_FoodDrink_economy = sum(Food.and.drink > 3 & Class == "Eco") / sum(Class == "Eco"),
         proportion_Entertainment_business = sum(Inflight.entertainment > 3 & Class == "Business") / sum(Class == "Business"),
         proportion_Entertainment_economy = sum(Inflight.entertainment > 3 & Class == "Eco") / sum(Class == "Eco"),
        proportion_Cleanliness_business = sum(Cleanliness > 3 & Class == "Business") / sum(Class == "Business"),
         proportion_Cleanliness_economy = sum(Cleanliness > 3 & Class == "Eco") / sum(Class == "Eco"),
         proportion_Legroom_business = sum(Leg.room.service> 3 & Class == "Business") / sum(Class == "Business"),
         proportion_Legroom_economy = sum(Leg.room.service > 3 & Class == "Eco") / sum(Class == "Eco"))


df_1 <- data_prop %>%
  select(proportion_SeatComfort_business, proportion_SeatComfort_economy, proportion_OnlineBoarding_business,
         proportion_OnlineBoarding_economy, proportion_OnboardingService_business, proportion_OnboardingService_economy,
         proportion_BaggageHandling_business, proportion_BaggageHandling_economy, proportion_CheckIn_business, proportion_CheckIn_economy,
         proportion_InflightService_business, proportion_InflightService_economy, proportion_Wifi_business, proportion_Wifi_economy,
         proportion_TimeConvenience_business, proportion_TimeConvenience_economy, proportion_OnlineBooking_business, 
         proportion_OnlineBooking_economy, proportion_GateLocation_business, proportion_GateLocation_economy, proportion_FoodDrink_business,
         proportion_FoodDrink_economy, proportion_Entertainment_business, proportion_Entertainment_economy, proportion_Cleanliness_business, proportion_Cleanliness_economy, proportion_Legroom_business,
proportion_Legroom_economy)
# convert data frame to tidy format

df_prop <- df_1%>%
slice(1) %>%
  pivot_longer(cols = everything(), names_to = "variable", values_to = "proportion")


df_prop<- separate(df_prop, variable, c("name","aspect","class"), sep = "_")


```


VISUALISATION OLD


```{r}
plot <- df_prop %>%
  pivot_wider(names_from = class, values_from = proportion) %>%
  mutate(delta = business - economy, 
         aspect = factor(aspect, unique(aspect[order(delta, decreasing = FALSE)]))) %>%
  ggplot() +
  geom_segment(aes(y= aspect , x = economy,yend = aspect , xend = business, color= aspect), size= 1.2) +
  scale_color_manual(values=c('red','red', "red", "grey89", "grey89", "grey89","grey89","grey89","grey89","grey89","grey89","green4", "green4", "green4" ))+
  geom_point(mapping = aes(y = aspect, x = economy), size = 3, shape=20) +
  geom_point(mapping = aes(y = aspect, x = business),size = 3, shape=17) +
  scale_x_continuous(limits = c(0, 1)) +
  labs(x = "Satisfaction Rate", color = "Class")+
  theme_minimal() + 
  theme(axis.text.y = element_text(vjust = 1), 
        axis.title.y = element_blank(),
        legend.text = element_blank(), 
        legend.position = "none")
  

plot
```


Visualisation - Improvements
```{r}


library(showtext)



font_add_google(name = 'Quicksand', family = 'Quicksand')


#font_family <- "Quicksand"
#font_size <- 20

```



NEW Visualistion!! 

```{r}
library(stringr)
font_size <- 20
background_color <- "#b6d5f0"

# Define the color palette
font_size <- 20
background_color <- "#b6d5f0"

# Define the color palette
num_colors <- 14
color_palette <- colorRampPalette(c("red", "orange", "green3"))(num_colors)

insert_space <- function(label) {
  str_replace_all(label, "([A-Z])", " \\1")}


plot <- df_prop %>%
  pivot_wider(names_from = class, values_from = proportion) %>%
  mutate(delta = business - economy, 
         aspect = factor(aspect, unique(aspect[order(delta, decreasing = FALSE)]))) %>%
  ggplot() +
  geom_segment(aes(y = aspect, x = economy, yend = aspect, xend = business, color = aspect), size = 1.2) +
  scale_color_manual(values = color_palette) +
  geom_point(mapping = aes(y = aspect, x = economy, color = aspect), size = 5, shape = 20) +
  geom_point(mapping = aes(y = aspect, x = business, color = aspect), size = 5, shape = 17) +
  scale_x_continuous(limits = c(0, 1)) +
  labs(x = "Satisfaction Rate") +
  scale_y_discrete(labels = insert_space)+
  theme_minimal() + 
  theme(
    axis.text.y = element_text(vjust = 1, size = font_size), 
    axis.title.y = element_blank(),
    legend.text = element_blank(), 
    legend.position = "none",
    plot.title = element_text(size = font_size),
    plot.background = element_rect(fill = background_color)
  )


plot


```


